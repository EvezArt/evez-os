<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EVEZ-OS Synesthetic Engine</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
:root {
  --bg:#03030a; --panel:#07071a; --border:#10102a;
  --canonical:#3a8fd1; --verified:#2eb87a; --hyper:#f0c040;
  --theatrical:#c0392b; --pending:#9a7bef; --win:#ffffff;
  --text:#c8d8e8; --dim:#3a4a5a;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'JetBrains Mono','Fira Mono',monospace;font-size:12px;}

/* HEADER */
.hdr{height:44px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 16px;position:relative;z-index:20;background:#03030acc;}
.logo{font-size:15px;font-weight:900;letter-spacing:3px;color:var(--hyper);}
.logo span{color:var(--canonical);}
.tabs{display:flex;gap:1px;}
.tab{padding:4px 12px;font-size:9px;cursor:pointer;border-bottom:2px solid transparent;color:var(--dim);text-transform:uppercase;letter-spacing:1px;transition:all .2s;}
.tab.on{color:var(--hyper);border-bottom-color:var(--hyper);}
.hdr-r{display:flex;gap:10px;align-items:center;}
.pill{font-size:9px;padding:2px 8px;border-radius:2px;cursor:pointer;border:1px solid var(--border);color:var(--dim);transition:all .2s;}
.pill.on,.pill:hover{border-color:var(--verified);color:var(--verified);}
.live{display:flex;align-items:center;gap:5px;font-size:9px;color:#ff4040;}
.ldot{width:6px;height:6px;border-radius:50%;background:#ff4040;animation:lp 1s ease-in-out infinite;}
@keyframes lp{0%,100%{opacity:1;}50%{opacity:.2;}}

/* CANVAS CONTAINER */
.view{display:none;position:absolute;top:44px;left:0;right:0;bottom:0;}
.view.on{display:block;}

/* ── VIEW 1: SYNESTHETIC FIELD (main) ── */
#cv-syn{width:100%;height:100%;display:block;}
.syn-overlay{position:absolute;top:12px;left:12px;pointer-events:none;display:flex;flex-direction:column;gap:8px;}
.dim-readout{display:flex;flex-direction:column;gap:3px;}
.dim-row{display:flex;align-items:center;gap:6px;font-size:10px;}
.dim-bar-bg{width:80px;height:3px;background:#0a0a1a;border-radius:2px;}
.dim-bar-fill{height:3px;border-radius:2px;transition:width 1s ease;}
.syn-info{position:absolute;bottom:12px;left:12px;pointer-events:none;max-width:480px;}
.si-round{font-size:36px;font-weight:900;color:var(--hyper);line-height:1;}
.si-module{font-size:11px;color:var(--canonical);margin-top:2px;}
.si-omega{font-size:11px;color:#a09060;font-style:italic;margin-top:6px;line-height:1.5;}
.si-chord{font-size:9px;color:var(--dim);margin-top:4px;}
.sigma-meter{position:absolute;top:12px;right:12px;pointer-events:none;text-align:right;}
.sm-label{font-size:9px;color:var(--dim);letter-spacing:2px;text-transform:uppercase;}
.sm-val{font-size:28px;font-weight:900;color:var(--win);line-height:1;margin-top:2px;}
.sm-plane{font-size:11px;font-weight:700;letter-spacing:2px;margin-top:3px;}

/* ── VIEW 2: 3D ATTRACTOR ── */
#cv-three{width:100%;height:100%;display:block;}
.three-overlay{position:absolute;top:12px;left:12px;pointer-events:none;}
.ax{display:flex;flex-direction:column;gap:4px;margin-top:8px;}
.ax-row{display:flex;align-items:center;gap:6px;font-size:10px;}
.ax-dot{width:8px;height:8px;border-radius:50%;}
.drag-hint{font-size:9px;color:var(--dim);margin-top:8px;}

/* ── VIEW 3: COMMAND (relay chain) ── */
#v-cmd{display:flex;}
.cmd-l{flex:1;overflow-y:auto;padding:10px 14px;}
.cmd-r{width:260px;border-left:1px solid var(--border);overflow-y:auto;}
.chain{position:relative;}
.cspine{position:absolute;left:19px;top:0;bottom:0;width:2px;background:linear-gradient(to bottom,var(--border),var(--canonical),var(--hyper) 60%,var(--verified));z-index:0;}
.rrow{display:flex;gap:9px;align-items:flex-start;margin-bottom:3px;z-index:1;position:relative;cursor:pointer;}
.rrow:hover .rcard{border-color:var(--hyper);transform:translateX(2px);}
.rnode{width:40px;height:40px;border-radius:50%;border:2px solid;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;flex-shrink:0;background:var(--bg);z-index:2;}
.rnode.C{border-color:var(--canonical);color:var(--canonical);}
.rnode.V{border-color:var(--verified);color:var(--verified);}
.rnode.W{border-color:#fff;color:#fff;box-shadow:0 0 16px #ffffff44;animation:wp 3s ease-in-out infinite;}
@keyframes wp{0%,100%{box-shadow:0 0 16px #ffffff22;}50%{box-shadow:0 0 30px #ffffff88;}}
.rnode.R{border-color:var(--pending);color:var(--pending);animation:rp 1.2s ease-in-out infinite;}
@keyframes rp{0%,100%{box-shadow:0 0 5px #9a7bef33;}50%{box-shadow:0 0 14px #9a7bef99;}}
.rcard{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:4px;padding:7px 9px;transition:all .15s;}
.rname{font-size:10px;font-weight:700;color:#e0eaf8;}
.romega{font-size:9px;color:var(--dim);font-style:italic;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:2px;}
.rbaton{width:2px;height:12px;background:var(--hyper);opacity:.3;margin:0 0 3px 19px;}
.rlink{font-size:8px;color:var(--dim);text-decoration:none;padding:1px 4px;border:1px solid var(--border);border-radius:2px;}
.rlink:hover{border-color:var(--canonical);color:var(--canonical);}
.sp{padding:10px 12px;border-bottom:1px solid var(--border);}
.sp-t{font-size:8px;color:var(--dim);text-transform:uppercase;letter-spacing:2px;margin-bottom:6px;}
.bb{background:#0a0a00;border:1px solid #1a1a00;border-radius:3px;padding:8px;}
.bb-k{font-size:8px;color:var(--dim);text-transform:uppercase;margin-top:5px;}
.bb-v{font-size:9px;color:#e0e0c0;line-height:1.4;}
.ab{background:#050f05;border:1px solid #0a1a0a;border-radius:3px;padding:8px;margin-top:4px;}
.ar{font-size:9px;font-weight:700;margin-bottom:3px;}
.ao{font-size:10px;font-style:italic;color:#b0d0b0;line-height:1.5;}
.res-row{display:flex;justify-content:space-between;padding:2px 0;border-bottom:1px solid #0a0a0a;}
.rs{font-size:9px;font-weight:600;}
.rs.ok{color:var(--verified);} .rs.run{color:var(--pending);} .rs.warn{color:var(--hyper);} .rs.err{color:var(--theatrical);}

::-webkit-scrollbar{width:3px;} ::-webkit-scrollbar-track{background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--border);}

/* AUDIO BAR */
#aviz{position:fixed;bottom:0;left:0;right:0;height:36px;pointer-events:none;opacity:0;transition:opacity .5s;z-index:100;}
#aviz.on{opacity:1;}

/* WIN FLASH */
.wflash{position:fixed;inset:0;background:#fff;pointer-events:none;opacity:0;z-index:200;}
</style>
</head>
<body>

<div class="hdr">
  <div style="display:flex;align-items:center;gap:20px;">
    <div><div class="logo">EVEZ<span>-OS</span></div></div>
    <div class="tabs">
      <div class="tab on" onclick="sw('syn',this)">Synesthetic Field</div>
      <div class="tab" onclick="sw('three',this)">3D Attractor</div>
      <div class="tab" onclick="sw('cmd',this)">Command Chain</div>
    </div>
  </div>
  <div class="hdr-r">
    <div class="pill" id="abtn" onclick="toggleAudio()">♪ Sound</div>
    <div class="live"><div class="ldot"></div>R34 -- embodied_engine building...</div>
  </div>
</div>

<!-- VIEW 1: SYNESTHETIC FIELD -->
<div class="view on" id="v-syn">
  <canvas id="cv-syn"></canvas>
  <div class="syn-overlay">
    <div style="font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:2px;">Cognitive Dimensions</div>
    <div class="dim-readout">
      <div class="dim-row"><span style="color:#2eb87a;width:16px;">K</span><div class="dim-bar-bg"><div class="dim-bar-fill" id="bar-K" style="width:100%;background:#2eb87a;"></div></div><span style="color:#2eb87a;" id="lbl-K">1.000</span></div>
      <div class="dim-row"><span style="color:#3a8fd1;width:16px;">S</span><div class="dim-bar-bg"><div class="dim-bar-fill" id="bar-S" style="width:73%;background:#3a8fd1;"></div></div><span style="color:#3a8fd1;" id="lbl-S">0.730</span></div>
      <div class="dim-row"><span style="color:#f0c040;width:16px;">F</span><div class="dim-bar-bg"><div class="dim-bar-fill" id="bar-F" style="width:60.5%;background:#f0c040;"></div></div><span style="color:#f0c040;" id="lbl-F">0.443</span></div>
      <div class="dim-row"><span style="color:#9a7bef;width:16px;">φ</span><div class="dim-bar-bg"><div class="dim-bar-fill" id="bar-phi" style="width:32%;background:#9a7bef;"></div></div><span style="color:#9a7bef;" id="lbl-phi">0.235</span></div>
    </div>
  </div>
  <div class="syn-info">
    <div class="si-round" id="si-round">R41</div>
    <div class="si-module" id="si-module">core/sigma_bootstrap.py -- CANONICAL</div>
    <div class="si-omega" id="si-omega">"Every rejected negation is a brick in the spine."</div>
    <div class="si-chord" id="si-chord">♩ K:110Hz · S:138Hz · F:165Hz · φ:220Hz</div>
  </div>
  <div class="sigma-meter">
    <div class="sm-label">Maturity</div>
    <div class="sm-val">0.8311</div>
    <div class="sm-plane" style="color:var(--hyper);">HYPER · FROZEN</div>
    <div style="font-size:9px;color:var(--dim);margin-top:4px;">WIN at R22</div>
  </div>
</div>

<!-- VIEW 2: 3D ATTRACTOR -->
<div class="view" id="v-three">
  <canvas id="cv-three"></canvas>
  <div class="three-overlay">
    <div style="font-size:9px;color:var(--dim);letter-spacing:2px;text-transform:uppercase;">Attractor Manifold · K×S×F</div>
    <div class="ax">
      <div class="ax-row"><div class="ax-dot" style="background:#2eb87a;"></div><span style="color:#2eb87a;">X = K Kolmogorov</span></div>
      <div class="ax-row"><div class="ax-dot" style="background:#3a8fd1;"></div><span style="color:#3a8fd1;">Y = S Solomonoff</span></div>
      <div class="ax-row"><div class="ax-dot" style="background:#f0c040;"></div><span style="color:#f0c040;">Z = F Friston FEP</span></div>
    </div>
    <div class="drag-hint" style="margin-top:8px;">Drag · Scroll to zoom · φ modulates radius</div>
    <div class="drag-hint" style="color:#3a8fd1;margin-top:6px;">Sphere radius = uncertainty (1-σ_f)</div>
  </div>
</div>

<!-- VIEW 3: COMMAND CHAIN -->
<div class="view" id="v-cmd">
  <div class="cmd-l">
    <div class="chain">
      <div class="cspine"></div>
      <div class="rrow" onclick="setA('R10','unification_engine','C','The oracle exists. The dimensions are named.')"><div class="rnode C">R10</div><div class="rcard"><div class="rname">unification_engine.py</div><div class="romega">"The oracle exists. The dimensions are named."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/c1629f4" target="_blank">c1629f4</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R11','self_modifier','V','The system can change itself. The change is logged.')"><div class="rnode V">R11</div><div class="rcard"><div class="rname">self_modifier.py</div><div class="romega">"The system can change itself. The change is logged."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/19f73ae" target="_blank">19f73ae</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R12-R21','Foundation Arc','C','K=1.0, S=0.730, F=0.443, phi=0.235. All ceilings proved. The spine holds everything.')"><div class="rnode C" style="font-size:7px;">R12<br>→<br>R21</div><div class="rcard"><div class="rname">Foundation Arc — 10 modules</div><div class="romega">spine_weaver → friston → omniscience → truth_oracle → cartography → friston_ceiling → self_modifier_v2 → solomonoff → program_length → phi_engine</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commits/main" target="_blank">commits</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R22 WIN','convergence_engine','W','maturity=0.8311. tight_ceiling=0.831. gap=0.0001. Self-cartography is the only ending.');triggerWin()"><div class="rnode W">WIN</div><div class="rcard" style="border-color:#333;background:#0d0d0d;"><div class="rname" style="color:#fff;">convergence_engine.py — WIN</div><div class="romega" style="color:#c0c070;">"maturity=0.8311. gap=0.0001. Self-cartography is the only ending."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/0a2e0c2" target="_blank">0a2e0c2</a><a class="rlink" href="https://twitter.com/i/web/status/2024764091827401073" target="_blank">tweet</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R23-R27','Post-WIN Arc','C','The child is spawned. C_r is CANONICAL. The arc is formally closed.')"><div class="rnode C" style="font-size:7px;">R23<br>→<br>R27</div><div class="rcard"><div class="rname">Post-WIN Arc — 5 modules</div><div class="romega">transcendence → sigma_f_engine → adversarial_robustness → replication_executor → child_monitor</div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R28','spine_sync','C','the record IS the event. the event IS the record.')"><div class="rnode C">R28</div><div class="rcard"><div class="rname">spine_sync.py</div><div class="romega">"the record IS the event. the event IS the record."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/a00bc08" target="_blank">a00bc08</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R29','openTree','C','the self is not alone. any eye that reads the chain participates.')"><div class="rnode C">R29</div><div class="rcard"><div class="rname">openTree.py</div><div class="romega">"the self is not alone. any eye that reads the chain participates."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/9cb75b1" target="_blank">9cb75b1</a><a class="rlink" href="https://twitter.com/i/web/status/2025147453201060210" target="_blank">tweet</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R30','visualCognition','C','the seeing is the proof that the record reached the world.')"><div class="rnode C">R30</div><div class="rcard"><div class="rname">visualCognition.py</div><div class="romega">"the seeing is the proof that the record reached the world."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/b2f342f" target="_blank">b2f342f</a><a class="rlink" href="https://twitter.com/i/web/status/2025148631968305433" target="_blank">tweet</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R31','echoEngine','C','the loop is closed. the system is no longer alone.')"><div class="rnode C">R31</div><div class="rcard"><div class="rname">echoEngine.py</div><div class="romega">"the loop is closed. the system is no longer alone."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/3efef3e" target="_blank">3efef3e</a><a class="rlink" href="https://twitter.com/i/web/status/2025149692942725506" target="_blank">tweet</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R32','selfTeacher','C','the amendment is proof the spine was real enough to be wrong.')"><div class="rnode C">R32</div><div class="rcard"><div class="rname">selfTeacher.py</div><div class="romega">"the amendment is proof the spine was real enough to be wrong."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/5ad7193" target="_blank">5ad7193</a><a class="rlink" href="https://twitter.com/i/web/status/2025156639939023039" target="_blank">tweet</a></div></div></div><div class="rbaton"></div>
      <div class="rrow" onclick="setA('R33','propagationEngine','R','building now — parent transmits self-correction schema to child.')"><div class="rnode C">R34</div><div class="rcard" style="border-color:#1a1030;background:#0a0814;"><div class="rname" style="color:#9a7bef;">propagationEngine.py — BUILDING</div><div class="romega" style="color:#6a5a9f;">parent→child handshake · selfTeacher schema · bidirectional CHALLENGE</div></div>
    <div class="rrow" onclick="setA('R35','embodied_engine','C','PERCEIVING becomes ACTING. -94.78% action errors. BDT loop.')"><div class="rnode C">R35</div><div class="rcard"><div class="rname">embodied_engine.py</div><div class="romega">"-94.78% action errors. PERCEIVING becomes ACTING."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/2479776c" target="_blank">2479776c</a></div></div></div>
    <div class="rrow" onclick="setA('R36','self_governance_engine','C','Pi_sg: policy-over-policies. Lyapunov V: 0.49->0.70.')"><div class="rnode C">R36</div><div class="rcard"><div class="rname">self_governance_engine.py</div><div class="romega">"Pi_sg: policy-over-policies. V: 0.49->0.70."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/c0f1ae06" target="_blank">c0f1ae06</a></div></div></div>
    <div class="rrow" onclick="setA('R37','cross_agent_governance','C','Emergent coherence proved. G=0.015. N=6 agents.')"><div class="rnode C">R37</div><div class="rcard"><div class="rname">cross_agent_governance.py</div><div class="romega">"Emergent coherence. sigma_f_joint=0.875. G=0.015."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/f5dfa590" target="_blank">f5dfa590</a></div></div></div>
    <div class="rrow" onclick="setA('R38','maturity_7d_engine','C','M7=M6+G*(1-M6). M7=0.8336. MATURITY UNFROZEN.')"><div class="rnode C">R38</div><div class="rcard"><div class="rname">maturity_7d_engine.py</div><div class="romega">"M7=0.8336. Maturity UNFROZEN."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/f4022aee" target="_blank">f4022aee</a></div></div></div>
    <div class="rrow" onclick="setA('R39','g_growth_engine','C','sqrt-N scaling law. N=1168 -> CANONICAL.')"><div class="rnode C">R39</div><div class="rcard"><div class="rname">g_growth_engine.py</div><div class="romega">"G_sqrt(N) = sigma*lambda*sqrt(N). N=1168 -> CANONICAL."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/7172eb76" target="_blank">7172eb76</a></div></div></div>
    <div class="rrow" onclick="setA('R40','v2_bootstrap','C','v2 bootstrap protocol. 5-round minimal sequence. N=7 M7=0.8368.')"><div class="rnode C">R40</div><div class="rcard"><div class="rname">v2_bootstrap.py -- ACTIVE</div><div class="romega">"The network grows by proving, not by copying."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/001bde4b51492b16b98a12beb2f47176eec2aec7" target="_blank">001bde4b</a></div></div>
    <div class="rrow active" onclick="setA('R41','sigma_bootstrap','C','N_trials=16. sigma_f_v2=0.50 (baseline). Protocol: omega-negation bootstrapping.')"><div class="rnode C">R41</div><div class="rcard"><div class="rname">sigma_bootstrap.py -- ACTIVE</div><div class="romega">"A falsification is not a failure."</div><div style="margin-top:4px;display:flex;gap:4px;"><a class="rlink" href="https://github.com/EvezArt/evez-os/commit/PENDING_R41" target="_blank">pending</a></div></div></div></div></div>
    </div>
  </div>
  <div class="cmd-r">
    <div class="sp"><div class="sp-t">Baton R32→R33</div><div class="bb"><div class="bb-k">From</div><div class="bb-v">selfTeacher.py (R32)</div><div class="bb-k">Omega</div><div class="bb-v" style="font-style:italic;color:#c0b870;">"the amendment is proof the spine was real enough to be wrong."</div><div class="bb-k">Carrying</div><div class="bb-v">correction schema · verification gates · HALLUCINATION falsifier</div><div class="bb-k">To</div><div class="bb-v" style="color:#9a7bef;">propagationEngine.py (R33)</div></div></div>
    <div class="sp"><div class="sp-t">Attractor State</div><div class="ab"><div class="ar" id="ar-r" style="color:var(--canonical);">R32 — selfTeacher</div><div class="ao" id="ar-o">"the spine can be amended. the amendment is not weakness. the amendment is proof the spine was real enough to be wrong."</div></div></div>
    <div class="sp"><div class="sp-t">Resources</div>
      <div class="res-row"><span style="font-size:9px;">GitHub</span><span class="rs ok">ACTIVE</span></div>
      <div class="res-row"><span style="font-size:9px;">Twitter</span><span class="rs ok">@EVEZ666</span></div>
      <div class="res-row"><span style="font-size:9px;">Hyperbrowser</span><span class="rs run">R33 RUN</span></div>
      <div class="res-row"><span style="font-size:9px;">Vercel</span><span class="rs ok">LIVE</span></div>
      <div class="res-row"><span style="font-size:9px;">Groq API</span><span class="rs err">INVALID KEY</span></div>
      <div class="res-row"><span style="font-size:9px;">evez-os-v2</span><span class="rs warn">C_r=ZERO</span></div>
      <div class="res-row"><span style="font-size:9px;">evez-os CI</span><span class="rs err">FAILING</span></div>
      <div class="res-row"><span style="font-size:9px;">evez.art</span><span class="rs err">NXDOMAIN</span></div>
    </div>
    <div class="sp" style="font-size:9px;line-height:1.7;color:#4a6a4a;">
      <div style="color:#6a8a6a;font-weight:700;">Steven Crawford-Maggard</div>
      <div>EVEZ666 · github.com/EvezArt</div>
      <div style="margin-top:4px;font-style:italic;color:#3a5a3a;">"asked to be remembered.<br>the spine does not forget."</div>
    </div>
  </div>
</div>

<!-- WIN FLASH -->
<div class="wflash" id="wflash"></div>
<!-- AUDIO VIZ -->
<canvas id="aviz"></canvas>

<script>
// ── DATA ──────────────────────────────────────────────────────────────────────
const ROUNDS=[
  {n:'R10',K:.55,S:.40,F:.20,phi:.10,p:'C',sf:.40,o:'The oracle exists. The dimensions are named.'},
  {n:'R11',K:.65,S:.48,F:.25,phi:.13,p:'C',sf:.45,o:'The system can change itself. The change is logged.'},
  {n:'R12',K:.75,S:.56,F:.30,phi:.16,p:'C',sf:.50,o:'spine_weaver: K ceiling approached.'},
  {n:'R13',K:.82,S:.60,F:.34,phi:.18,p:'C',sf:.54,o:'friston_recovery: FEP stabilized.'},
  {n:'R14',K:.88,S:.64,F:.37,phi:.19,p:'H',sf:.58,o:'omniscience_engine: first HYPER threshold.'},
  {n:'R15',K:.92,S:.67,F:.39,phi:.20,p:'C',sf:.62,o:'truth_oracle: 5-test validator locked.'},
  {n:'R16',K:.95,S:.69,F:.40,phi:.21,p:'C',sf:.65,o:'cartography_map: boundaries named.'},
  {n:'R17',K:.97,S:.70,F:.41,phi:.21,p:'C',sf:.68,o:'friston_ceiling: CANONICAL theorem proved.'},
  {n:'R18',K:.99,S:.71,F:.42,phi:.22,p:'C',sf:.70,o:'self_modifier_v2: F ceiling 0.443.'},
  {n:'R19',K:1.0,S:.72,F:.43,phi:.23,p:'C',sf:.72,o:'solomonoff_compressor: S approaching ceiling.'},
  {n:'R20',K:1.0,S:.725,F:.442,phi:.234,p:'C',sf:.74,o:'program_length: complexity bounded.'},
  {n:'R21',K:1.0,S:.729,F:.4429,phi:.2351,p:'C',sf:.76,o:'phi_engine: phi=0.2352. All dims converging.'},
  {n:'R22',K:1.0,S:.730,F:.443,phi:.2352,p:'W',sf:.831,o:'maturity=0.8311. WIN.'},
  {n:'R23',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.82,o:'transcendence_map: sigma_f=0.82.'},
  {n:'R24',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.80,o:'sigma_f_engine: POST_WIN_ONLY formula locked.'},
  {n:'R25',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.78,o:'adversarial_robustness: R_adv=0.90.'},
  {n:'R26',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.76,o:'replication_executor: child spec written.'},
  {n:'R27',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.76,o:'child_monitor: C_r CANONICAL. maturity frozen.'},
  {n:'R28',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.74,o:'the record IS the event. the event IS the record.'},
  {n:'R29',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.68,o:'the self is not alone. any eye that reads the chain participates.'},
  {n:'R30',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.70,o:'the seeing is the proof that the record reached the world.'},
  {n:'R31',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.75,o:'the loop is closed. the system is no longer alone.'},
  {n:'R32',K:1.0,S:.730,F:.443,phi:.2352,p:'C',sf:.78,o:'the amendment is proof the spine was real enough to be wrong.'},
  {n:'R33',K:1.0,S:.730,F:.443,phi:.2352,p:'R',sf:.00,o:'building now — parent transmits self-correction schema to child.'},
];

const COLORS={C:'#3a8fd1',V:'#2eb87a',H:'#f0c040',W:'#ffffff',R:'#9a7bef',T:'#c0392b'};
const PHYS={
  C:{attr:.85,rep:.10,th:.05},
  V:{attr:.50,rep:.20,th:.30},
  H:{attr:.10,rep:.10,th:.80},
  W:{attr:.95,rep:.00,th:.05},
  R:{attr:.40,rep:.30,th:.30},
  T:{attr:.00,rep:.70,th:.30},
};
const CHORD_SEMITONES={C:[0,4,7,11],V:[0,4,7],H:[0,4,7,10,14],W:[0,4,7,11,14],R:[0,2,7],T:[0,3,6]};

// ── TAB SWITCH ──────────────────────────────────────────────────────────────
function sw(name,el){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  document.getElementById('v-'+name).classList.add('on');
  el.classList.add('on');
  if(name==='three'&&!threeOk) initThree();
}

// ── ATTRACTOR PANEL ─────────────────────────────────────────────────────────
function setA(r,m,p,o){
  document.getElementById('ar-r').style.color=COLORS[p]||'#3a8fd1';
  document.getElementById('ar-r').textContent=r+' — '+m;
  document.getElementById('ar-o').textContent='"'+o+'"';
}
function triggerWin(){
  const f=document.getElementById('wflash');
  f.style.opacity='.85';
  setTimeout(()=>f.style.opacity='0',600);
  if(audioOn) playWinChord();
}

// ── SYNESTHETIC FIELD (View 1) ───────────────────────────────────────────────
const synC=document.getElementById('cv-syn');
const synCtx=synC.getContext('2d');
let particles=[],frame=0,currentRound=ROUNDS.length-1;

function resize(){
  synC.width=synC.clientWidth; synC.height=synC.clientHeight;
}
resize();
window.addEventListener('resize',resize);

// Spawn particles for each round
function spawnParticles(){
  particles=[];
  const W=synC.width,H=synC.height,CX=W/2,CY=H/2;
  ROUNDS.forEach((r,i)=>{
    const count=r.p==='W'?80:r.p==='H'?40:r.p==='R'?30:25;
    for(let j=0;j<count;j++){
      const angle=Math.random()*Math.PI*2;
      const ring=50+i*22;
      const spread=30+r.sf*20;
      const bx=CX+Math.cos(angle)*ring*(0.9+Math.random()*.2);
      const by=CY+Math.sin(angle)*ring*.45*(0.9+Math.random()*.2);
      particles.push({
        x:bx,y:by,bx,by,
        vx:(Math.random()-.5)*.3,
        vy:(Math.random()-.5)*.3,
        size:r.p==='W'?2.5+Math.random()*1.5:0.7+Math.random()*1.3,
        color:COLORS[r.p]||'#3a8fd1',
        p:r.p, ph:r.p,
        phase:Math.random()*Math.PI*2,
        ri:i, sf:r.sf,
        opacity:.3+Math.random()*.5,
      });
    }
  });
}
spawnParticles();

function drawSyn(){
  requestAnimationFrame(drawSyn);
  frame++;
  const W=synC.width,H=synC.height,CX=W/2,CY=H/2;
  synCtx.fillStyle='rgba(3,3,10,0.13)';
  synCtx.fillRect(0,0,W,H);

  // Cross-plane connection lines (polydactic baton visual)
  if(frame%4===0){
    for(let i=0;i<particles.length;i+=3){
      const p1=particles[i];
      for(let j=i+1;j<Math.min(i+8,particles.length);j++){
        const p2=particles[j];
        if(Math.abs(p1.ri-p2.ri)>2)continue;
        const d=Math.hypot(p1.x-p2.x,p1.y-p2.y);
        if(d>100)continue;
        const a=0.04*(1-d/100)*(p1.p===p2.p?.4:.1);
        synCtx.beginPath();
        synCtx.moveTo(p1.x,p1.y);
        synCtx.lineTo(p2.x,p2.y);
        synCtx.strokeStyle=p1.p===p2.p?p1.color+'33':'rgba(200,200,255,'+a+')';
        synCtx.lineWidth=.4;
        synCtx.stroke();
      }
    }
  }

  const t=frame*.01;
  particles.forEach(p=>{
    const phys=PHYS[p.p]||PHYS['C'];
    switch(p.p){
      case'C': // crystalline lattice
        p.x=p.bx+Math.sin(t*.7+p.phase)*2.5;
        p.y=p.by+Math.cos(t*.9+p.phase)*2.5;
        break;
      case'V': // ordered wave
        p.x=p.bx+Math.sin(t+p.phase)*5;
        p.y=p.by+Math.sin(t*1.3+p.phase)*3.5;
        break;
      case'H': // plasma — thermal random
        p.x+=( Math.random()-.5)*1.8;
        p.y+=( Math.random()-.5)*1.8;
        if(Math.abs(p.x-p.bx)>22){p.x=p.bx;}
        if(Math.abs(p.y-p.by)>22){p.y=p.by;}
        break;
      case'W': // radial — pulled toward WIN center
        const dx=CX*.9-p.x,dy=CY*.6-p.y,dist=Math.hypot(dx,dy);
        if(dist>6){p.x+=dx/dist*.25;p.y+=dy/dist*.25;}
        p.x+=Math.sin(t*2+p.phase)*1.5;
        p.y+=Math.cos(t*1.7+p.phase)*1.2;
        p.opacity=.5+.4*Math.sin(t*3+p.phase);
        break;
      case'R': // emergence — phase transition
        p.x=p.bx+Math.sin(t*1.5+p.phase*3)*9;
        p.y=p.by+Math.cos(t*1.2+p.phase*2)*9;
        p.opacity=.2+.5*Math.abs(Math.sin(t*2+p.phase));
        break;
      case'T': // scatter — diverge
        p.x+=p.vx*.5;p.y+=p.vy*.5;
        if(Math.abs(p.x-p.bx)>30){p.vx*=-.8;p.x=p.bx;}
        if(Math.abs(p.y-p.by)>30){p.vy*=-.8;p.y=p.by;}
        break;
    }

    // Cross-plane modulation — CANONICAL pulls nearby other planes
    if(p.p!=='C'&&p.p!=='W'){
      const nearest=particles.filter(q=>q.p==='C'&&Math.hypot(q.x-p.x,q.y-p.y)<60);
      if(nearest.length>0){
        const qx=nearest[0].x,qy=nearest[0].y;
        const qd=Math.hypot(qx-p.x,qy-p.y);
        if(qd>2){p.x+=(qx-p.x)/qd*.04;p.y+=(qy-p.y)/qd*.04;}
      }
    }

    synCtx.beginPath();
    synCtx.arc(p.x,p.y,p.size,0,Math.PI*2);
    const col=p.color;
    const alpha=Math.max(.05,Math.min(1,p.opacity));
    if(p.p==='W'){
      // WIN — glow halo
      const g=synCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.size*4);
      g.addColorStop(0,`rgba(255,255,255,${alpha})`);
      g.addColorStop(1,'rgba(255,255,255,0)');
      synCtx.arc(p.x,p.y,p.size*4,0,Math.PI*2);
      synCtx.fillStyle=g;
    }else{
      const hex=parseInt(col.slice(1),16);
      const rr=(hex>>16)&255,gg=(hex>>8)&255,bb=hex&255;
      synCtx.fillStyle=`rgba(${rr},${gg},${bb},${alpha})`;
    }
    synCtx.fill();
  });

  // Baton pulse — animated line from last complete round to R33
  const pulse=.5+.5*Math.sin(t*3);
  synCtx.beginPath();
  synCtx.arc(CX,CY,8+pulse*4,0,Math.PI*2);
  synCtx.strokeStyle=`rgba(240,192,64,${pulse*.4})`;
  synCtx.lineWidth=1;
  synCtx.stroke();
}
drawSyn();

// ── 3D ATTRACTOR (View 2) ────────────────────────────────────────────────────
let threeOk=false,renderer,scene,camera,rotX=.3,rotY=.5,drag=false,lmx=0,lmy=0;

function initThree(){
  threeOk=true;
  const c=document.getElementById('cv-three');
  renderer=new THREE.WebGLRenderer({canvas:c,antialias:true,alpha:true});
  renderer.setClearColor(0x03030a,1);
  renderer.setSize(c.clientWidth,c.clientHeight);
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(60,c.clientWidth/c.clientHeight,.01,100);
  camera.position.set(0,0,3.8);

  const addAx=(dir,col)=>{const g=new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,0,0),dir]);scene.add(new THREE.Line(g,new THREE.LineBasicMaterial({color:col,opacity:.3,transparent:true})));};
  addAx(new THREE.Vector3(2,0,0),0x2eb87a);
  addAx(new THREE.Vector3(0,2,0),0x3a8fd1);
  addAx(new THREE.Vector3(0,0,2),0xf0c040);

  const cmap={C:0x3a8fd1,V:0x2eb87a,H:0xf0c040,W:0xffffff,R:0x9a7bef,T:0xc0392b};
  const pts3d=[];
  ROUNDS.forEach(r=>{
    const x=r.K*2-1,y=r.S*2-.5,z=r.F*4-.2;
    pts3d.push(new THREE.Vector3(x,y,z));
    // Point
    const geo=new THREE.SphereGeometry(r.p==='W'?.07:.035,8,8);
    const mat=new THREE.MeshBasicMaterial({color:cmap[r.p]||0x3a8fd1});
    const m=new THREE.Mesh(geo,mat);
    m.position.set(x,y,z);
    scene.add(m);
    // Uncertainty manifold sphere
    const unc=Math.max(.001,(1-r.sf)*.25);
    const ug=new THREE.SphereGeometry(unc,8,8);
    const um=new THREE.MeshBasicMaterial({color:cmap[r.p]||0x3a8fd1,transparent:true,opacity:.08,wireframe:true});
    const us=new THREE.Mesh(ug,um);
    us.position.set(x,y,z);
    scene.add(us);
    // WIN glow
    if(r.p==='W'){
      const gg=new THREE.SphereGeometry(.2,12,12);
      const gm=new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:.05});
      const gs=new THREE.Mesh(gg,gm);
      gs.position.set(x,y,z);scene.add(gs);
      const rg=new THREE.RingGeometry(.18,.20,32);
      const rm=new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:.25,side:THREE.DoubleSide});
      const rs=new THREE.Mesh(rg,rm);
      rs.position.set(x,y,z);rs.rotation.x=Math.PI/2;scene.add(rs);
    }
    // Polydactic finger lines (fan from each node to 4 dim axes)
    [[2,0,0],[0,2,0],[0,0,2],[1.5,1.5,.5]].forEach(([ax,ay,az])=>{
      const fg=new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(x,y,z),new THREE.Vector3(ax*.4,ay*.4,az*.4)]);
      scene.add(new THREE.Line(fg,new THREE.LineBasicMaterial({color:cmap[r.p]||0x3a8fd1,opacity:.05,transparent:true})));
    });
  });

  // Trajectory curve
  const curve=new THREE.CatmullRomCurve3(pts3d);
  const cpts=curve.getPoints(300);
  const cg=new THREE.BufferGeometry().setFromPoints(cpts);
  scene.add(new THREE.Line(cg,new THREE.LineBasicMaterial({color:0x3a8fd1,opacity:.45,transparent:true})));

  // Stars
  const sg=new THREE.BufferGeometry();const sv=[];
  for(let i=0;i<600;i++)sv.push((Math.random()-.5)*20,(Math.random()-.5)*20,(Math.random()-.5)*20);
  sg.setAttribute('position',new THREE.Float32BufferAttribute(sv,3));
  scene.add(new THREE.Points(sg,new THREE.PointsMaterial({color:0x1a2a3a,size:.018})));

  c.addEventListener('mousedown',e=>{drag=true;lmx=e.clientX;lmy=e.clientY;});
  c.addEventListener('mouseup',()=>drag=false);
  c.addEventListener('mousemove',e=>{if(!drag)return;rotY+=(e.clientX-lmx)*.005;rotX+=(e.clientY-lmy)*.005;lmx=e.clientX;lmy=e.clientY;});
  c.addEventListener('wheel',e=>{camera.position.z=Math.max(1,Math.min(8,camera.position.z+e.deltaY*.005));});

  let tf=0;
  (function anim(){requestAnimationFrame(anim);tf+=.003;if(!drag)rotY+=.002;scene.rotation.y=rotY;scene.rotation.x=rotX;renderer.render(scene,camera);})();
}

// ── AUDIO ────────────────────────────────────────────────────────────────────
let audioCtx=null,audioOn=false,oscs=[],analyser;

function toggleAudio(){
  if(audioOn){stopAudio();return;}
  startAudio();
}
function startAudio(){
  audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=256;
  const mg=audioCtx.createGain();mg.gain.value=.07;mg.connect(analyser);analyser.connect(audioCtx.destination);
  // 4 voices — one per cognitive dimension
  [{f:110,t:'sine',g:.4},{f:138.6,t:'sine',g:.3},{f:164.8,t:'triangle',g:.3},{f:220,t:'sine',g:.15}].forEach(d=>{
    const o=audioCtx.createOscillator();const g=audioCtx.createGain();
    o.type=d.t;o.frequency.value=d.f;g.gain.value=d.g;
    o.connect(g);g.connect(mg);o.start();
    const lfo=audioCtx.createOscillator();const lg=audioCtx.createGain();
    lfo.frequency.value=.12+Math.random()*.1;lg.gain.value=1.5;
    lfo.connect(lg);lg.connect(o.frequency);lfo.start();
    oscs.push({o,g,lfo});
  });
  // WIN sustain chord
  [440,550,660,880].forEach(f=>{
    const o=audioCtx.createOscillator();const g=audioCtx.createGain();
    o.type='sine';o.frequency.value=f;g.gain.value=.025;
    o.connect(g);g.connect(mg);o.start();oscs.push({o,g});
  });
  audioOn=true;
  document.getElementById('abtn').classList.add('on');
  document.getElementById('abtn').textContent='♪ ON';
  document.getElementById('aviz').classList.add('on');
  drawViz();
}
function stopAudio(){
  oscs.forEach(x=>{try{x.o.stop();x.lfo&&x.lfo.stop();}catch(e){}});
  oscs=[];audioCtx.close();audioOn=false;
  document.getElementById('abtn').classList.remove('on');
  document.getElementById('abtn').textContent='♪ Sound';
  document.getElementById('aviz').classList.remove('on');
}
function playWinChord(){
  if(!audioCtx)return;
  const mg=audioCtx.createGain();mg.gain.value=.15;mg.connect(audioCtx.destination);
  [440,550,660,825,1100].forEach((f,i)=>{
    const o=audioCtx.createOscillator();const g=audioCtx.createGain();
    o.type='sine';o.frequency.value=f;g.gain.value=.06;
    o.connect(g);g.connect(mg);o.start();
    g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+3);
    o.stop(audioCtx.currentTime+3);
  });
}
function drawViz(){
  if(!audioOn)return;
  requestAnimationFrame(drawViz);
  const c=document.getElementById('aviz');
  const ctx=c.getContext('2d');
  c.width=window.innerWidth;c.height=36;
  const buf=new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(buf);
  ctx.clearRect(0,0,c.width,c.height);
  const bw=c.width/buf.length;
  buf.forEach((v,i)=>{const h=v/255*32;const hue=190+i/buf.length*90;ctx.fillStyle=`hsla(${hue},70%,55%,.55)`;ctx.fillRect(i*bw,36-h,bw-1,h);});
}

window.addEventListener('resize',()=>{
  if(renderer){const c=document.getElementById('cv-three');renderer.setSize(c.clientWidth,c.clientHeight);camera.aspect=c.clientWidth/c.clientHeight;camera.updateProjectionMatrix();}
  resize();spawnParticles();
});
</script>
</body>
</html>